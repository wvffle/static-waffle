mixin lib(provider, path)
  - var isStyle = path.endsWith('.css')
  - var url = 'https://cdn.jsdelivr.net/' + provider + '/' + path
  if isStyle
    link(rel='stylesheet', href=url)
  else
    script(src=url)
      
mixin npm(path)
  +lib('npm', path)
      
mixin gh(path)
  +lib('gh', path)

mixin wp(path)
  +lib('wp', path)
  
mixin root(path, ext)
  - path = path.replace(/(\..+|)$/, ext)
  if ext === '.css'
    link(rel='stylesheet', href=path)
      
  else if ~['.jpg', '.png'].indexOf(ext)
    img(src=path)
      
  else
    script(src=path)
  
mixin asset(path, ext)
  +root(view + '/assets/' + path, ext)
  
mixin style(path)
  if (path[0] === '/')
    +root(path.slice(1), '.css')
  else
    +asset('css/' + path, '.css')
  
mixin script(path)
  if (path[0] === '/')
    +root(path.slice(1), '.js')
  else
    +asset('js/' + path, '.js')
  
mixin image(path)
  - var ext = path.split('/').slice(-1)[0].match(/[^.]+(\..+)$/)[1]
  if (path[0] === '/')
    +root(path.slice(1), ext)
  else
    +asset('img/' + path, ext)
  
doctype html
html
  head
    block pre-head
      meta(charset='utf-8')
    
    block head
      title static-waffle
      
    block scripts
      script(src="https://cdn.polyfill.io/v2/polyfill.js")
        
      +npm('vue/dist/vue.js')
      +npm('vue-router/dist/vue-router.min.js')
      +npm('axios/dist/axios.min.js')
      +npm('nprogress')
      +npm('lodash')
      
      script.
        window._waffle = {
          view: `#{view}`,
          err: !{!err || err.status === 200 ? false : JSON.stringify(err)}
        }
        
      +script('/components')
      
    mixin font(name, sizes = [ 400 ])
      link(rel='stylesheet', href='https://fonts.googleapis.com/css?family=' + name.replace(/\s/g, '+') + ':' + sizes.join(','))
      
    block styles
      +npm('reset.css')
      +npm('nprogress/nprogress.css')
      +font('Source Sans Pro', [ 200, 400, 700 ])
      
  body
    #app
      router-view
        
    block post-scripts
      +script('routes')
      +script('app')
