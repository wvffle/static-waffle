(async () => {
  const axiosOptions = { responseType: 'text' }

  for (const component of <%- components %>) {
    Vue.component(component, (resolve, reject) => {
      axios.get(`components/${component}.js`, axiosOptions).then(response => {
        'use strict'
        const options = eval(`${response.data}\n;component`)

        const { waffle_style, waffle_template } = options

        Promise.all([
          (async () => {
            if (waffle_template) {
              return axios.get(`components/templates/${component}.tmpl`, axiosOptions)
            }
          })(),
          (async () => waffle_style && _waffle.loadStyle(component))(),
        ]).then(([ template ]) => {
          if (options.waffle_template) {
            options.template = template.data
          }

          delete options.waffle_style
          delete options.waffle_template

          resolve(options)
        })
      })

    })
  }
})()
